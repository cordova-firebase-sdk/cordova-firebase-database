sudo: false

env:
  global:
  - TRAVIS_NODE_VERSION="5.5"
  - ANDROID_API_LEVEL=27
  - ANDROID_BUILD_TOOLS_VERSION=27.0.3
  - ANDROID_ABI=google_apis/armeabi-v7a

notifications:
  email: false

branches:
  only:
  - master

matrix:
  include:
  - env: PLATFORM=android-7.0
    os: linux
    node_js: '${TRAVIS_NODE_VERSION}'
    language: android
    jdk: oraclejdk8
    android:
      components:
      - platform-tools
      - tools
      - build-tools-$ANDROID_BUILD_TOOLS_VERSION
      - android-$ANDROID_API_LEVEL
      - addon-google_apis-google-$ANDROID_API_LEVEL
      - extra-google-google_play_services
      - sys-img-armeabi-v7a-android-$ANDROID_API_LEVEL
    licenses:
      - 'android-sdk-preview-license-52d11cd2'
      - 'android-sdk-license-.+'
      - 'google-gdk-license-.+'

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache
    
before_install:
  - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm
    && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm
    install ${TRAVIS_NODE_VERSION} > /dev/null
  - node --version
  - npm install -g cordova@${CORDOVA_VERSION} > /dev/null
  - npm install -g cordova-paramedic > /dev/null
  - cordova --version

before_script:
  - if [[ "$PLATFORM" =~ android ]]; then
      echo yes | sdkmanager "system-images;android-$ANDROID_API_LEVEL;google_apis;x86_64";
      echo no | $ANDROID_HOME/tools/bin/avdmanager create avd --force --name test --abi google_apis/x86 --package "system-images;android-$ANDROID_API_LEVEL;google_apis;x86";
      yes | sdkmanager --licenses > /dev/null;
      $ANDROID_HOME/tools/emulator -avd test > /dev/null;
    fi


install:
  - npm cache clean > /dev/null
  - npm install > /dev/null

script:
  - npm test
  - if [[ "$PLATFORM" =~ android ]]; then
      cordova-paramedic --platform android --plugin .;
    fi
