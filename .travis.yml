sudo: false

env:
  global:
  - TRAVIS_NODE_VERSION="5.5"
  - EMULATOR_NAME="testdevice"

notifications:
  email: false

branches:
  only:
  - master

matrix:
  include:
  - os: linux
    env: CORDOVA_VERSION="8.0.0" CORDOVA_PLATFORM="browser"
    language: node_js
    node_js: '${TRAVIS_NODE_VERSION}'
  - env: PLATFORM=android-7.0
    os: linux
    node_js: '${TRAVIS_NODE_VERSION}'
    language: android
    jdk: oraclejdk8
    android:
      components:
      - tools
      - build-tools-26.0.2
      - platform-tools

before_install:
  - rm -rf ~/.nvm && git clone https://github.com/creationix/nvm.git ~/.nvm && (cd ~/.nvm
    && git checkout `git describe --abbrev=0 --tags`) && source ~/.nvm/nvm.sh && nvm
    install ${TRAVIS_NODE_VERSION}
  - node --version
  - npm install -g cordova@${CORDOVA_VERSION} > /dev/null
  - npm install -g cordova-paramedic > /dev/null
  - cordova --version



install:
  - npm cache clean > /dev/null
  - npm install > /dev/null

script:
  - npm test
  - if [[ "$PLATFORM" =~ android ]]; then
      yes | sdkmanager "platforms;android-27" > /dev/null;
      yes | sdkmanager tools > /dev/null;
      yes | sdkmanager --licenses > /dev/null;
      echo no | ${ANDROID_HOME}/tools/bin/avdmanager create avd -n Nexus5_API24 -k "system-images;android-24;googl
e_apis;x86" --tag "google_apis"
      ${ANDROID_HOME}/tools/emulator -avd $EMULATOR_NAME -skin 450x800 -no-audio -no-window -netspeed full -netdelay none &
      android-wait-for-emulator;
      npm run paramedic_android;
    fi
